<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core">


<h:head>
	<title>Caisse</title>



</h:head>
<h:body>
#{CaisseBean.getThereIsOpened()}"

	<p:layout fullPage="true">


		<p:layoutUnit position="south" size="200" header="Bottom"
			resizable="true" collapsible="true">
			<h:panelGrid columns="2" id="recap">
				<h:outputText value="Total Brut:" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalPrixBrute} DT" />
				<h:outputText value="Remise :" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalRemise} DT" />
				<h:outputText value="" />
				<h:outputText value="--------------" />
				<h:outputText value="Total :" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalPrixTTC} DT" />

				<h:outputText value=" Gain :" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalGain} DT" />

				<h:outputText value=" Prix mini :" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalPrixMini} DT" />


			</h:panelGrid>
		</p:layoutUnit>

		<p:layoutUnit header="Panier" position="west" size="800"
			resizable="true">

			<h:form id="panier">

				<p:messages id="messages" showDetail="true" closable="true">
					<p:autoUpdate />
				</p:messages>

				<h:panelGrid columns="2">
					<h:outputText value="" />
					<h:outputText value="" />

					<h:outputText value="Total Brut:" />
					<h:outputText
						value="#{LiveCaisseController.bonLivraison.totalPrixBrute} DT" />

					<h:outputText value="Remise :" />
					<p:inputNumber id="Remise"
						value="#{LiveCaisseController.bonLivraison.remise}" label="Remise"
						symbol="%" symbolPosition="s" emptyValue="sign" minValue="00.000"
						maxValue="100">
						<p:ajax event="keyup"
							update="total,listeLigneVente,recap,FormValider" />
					</p:inputNumber>

					<h:outputText value="Total :" />
					<p:inputNumber id="total"
						value="#{LiveCaisseController.bonLivraison.totalPrixTTC}"
						label="Total" symbol="DT" symbolPosition="s" emptyValue="sign"
						minValue="00.000">
						<p:ajax event="keyup"
							update="Remise,listeLigneVente,recap,FormValider" />
					</p:inputNumber>


					<p:commandButton value="Valider"
						onclick="PF('WindowsValider').show();" />
					<p:commandButton value="Remise à zéro" id="zero" />

				</h:panelGrid>


				<p:dataTable id="listeLigneVente" var="lignevente"
					value="#{LiveCaisseController.bonLivraison.ligneLivraisons}"
					selectionMode="single"
					selection="#{LiveCaisseController.selectedLigneVente}"
					rowKey="#{lignevente.article.id}">
					<p:column headerText="Marque" width="100">
						<h:outputText value="#{lignevente.article.marque.designation}" />
					</p:column>

					<p:column headerText="Code" width="70">
						<h:outputText value="#{lignevente.article.item.code}" />
					</p:column>

					<p:column headerText="Designation">
						<h:outputText value="#{lignevente.article.item.designation}" />
					</p:column>

					<p:column headerText="prix" width="60">
						<h:outputText value="#{lignevente.prix_ttc}" />
					</p:column>

					<p:column headerText="Qte" width="60">
						<h:outputText value="#{lignevente.qte}" />
					</p:column>
					<p:column headerText="total" width="60">
						<h:outputText value="#{lignevente.totalPrixTTC}" />
					</p:column>

					<p:ajax event="rowSelect"
						listener="#{LiveCaisseController.onRowSelectLignevente}"
						oncomplete="PF('DetailArticle').show()" update="detail_article" />

				</p:dataTable>


			</h:form>

		</p:layoutUnit>

		<p:layoutUnit header="Liste Article" position="center"
			collapsible="true">

			<h:form>
				<p:dataTable var="article" value="#{ArticleBean.listArticles}"
					selectionMode="single"
					selection="#{LiveCaisseController.selectedArticle}"
					rowKey="#{article.id}">


					<p:column headerText="Marque"
						filterBy="#{article.marque.designation}"
						filterMatchMode="contains" width="100">
						<h:outputText value="#{article.marque.designation}" />
					</p:column>

					<p:column headerText="Code" filterBy="#{article.item.code}"
						filterMatchMode="contains" width="100">
						<h:outputText value="#{article.item.code}" />
					</p:column>
					<p:column headerText="Designation"
						filterBy="#{article.item.designation}" filterMatchMode="contains">
						<h:outputText value="#{article.item.designation}" />
					</p:column>
					<p:column headerText="Prix vente" filterBy="#{article.prixvente}"
						filterMatchMode="contains" width="100">
						<h:outputText value="#{article.prixvente}" />
					</p:column>
					<p:column headerText="Stock" filterBy="#{article.stockTotal}"
						filterMatchMode="contains" width="70">
						<h:outputText value="#{article.stockTotal}" />
					</p:column>
					<p:column headerText="Position" filterBy="#{article.position}"
						filterMatchMode="contains" width="100">
						<h:outputText value="#{article.position}" />
					</p:column>

					<p:ajax event="rowSelect" oncomplete="PF('DetailArticle').show()"
						update="detail_article" />


				</p:dataTable>

			</h:form>

			<p:dialog header="Detail Article" widgetVar="DetailArticle"
				width="600">

				<h:panelGrid id="detail_article" columns="2"
					columnClasses="label, value">

					<h:outputText value="Marque : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.marque.designation}" />
					<h:outputText value="Code : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.item.code}" />
					<h:outputText value="Designation : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.item.designation}" />
					<h:outputText value="Prix de vente : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.prixvente}" />
					<h:outputText value="Prix Mini : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.prixmini}" />
					<h:outputText value="Stock : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.stockTotal}" />
					<h:outputText value="Position : " />
					<h:outputText
						value="#{LiveCaisseController.selectedArticle.position}" />
				</h:panelGrid>
				<h:form>

					<h:outputText value="Quantitée : " />
					<p:inputNumber id="qte" value="#{LiveCaisseController.qteToAdd}"
						size="30" emptyValue="sign">
					</p:inputNumber>


					<p:commandButton
						action="#{LiveCaisseController.addLigneToPanier(LiveCaisseController.selectedArticle)}"
						icon="ui-icon-plus" value="Ajouter au panier" title="add"
						update="panier,qte,recap,FormValider"
						oncomplete="PF('DetailArticle').hide()">
					</p:commandButton>
					<p:commandButton
						action="#{LiveCaisseController.removeLigneFromPanier(LiveCaisseController.selectedArticle)}"
						icon="ui-icon-plus" value="Supprimer du panier" title="remove"
						update="panier,qte,recap,FormValider"
						oncomplete="PF('DetailArticle').hide()">
					</p:commandButton>


				</h:form>





			</p:dialog>

		</p:layoutUnit>

	</p:layout>

	<p:dialog header="Valider Vente" widgetVar="WindowsValider"
		modal="true" width="850">

		<h:form id="FormValider">
			<h:panelGrid columns="2">
				<h:outputText value="" />
				<h:outputText value="" />

				<h:outputText value="Total Brut:" />
				<h:outputText
					value="#{LiveCaisseController.bonLivraison.totalPrixBrute} DT" />

				<h:outputText value="Remise :" />
				<h:outputText value="#{LiveCaisseController.bonLivraison.remise}" />

				<h:outputText value="Total :" />
				<h:outputText id="total"
					value="#{LiveCaisseController.bonLivraison.totalPrixTTC}" />


				<h:outputText value="Argent reçu :" />
				<h:outputText value="#{LiveCaisseController.argent}" />
				<h:outputText value="Monnaie a rendre :" />
				<h:outputText value="#{LiveCaisseController.monnaie}" />

				<p:commandButton value="Valider" id="B_valider" />
			</h:panelGrid>


			<p:dataTable var="lignevente"
				value="#{LiveCaisseController.bonLivraison.ligneLivraisons}">
				<p:column headerText="Marque" width="100">
					<h:outputText value="#{lignevente.article.marque.designation}" />
				</p:column>

				<p:column headerText="Code" width="70">
					<h:outputText value="#{lignevente.article.item.code}" />
				</p:column>

				<p:column headerText="Designation">
					<h:outputText value="#{lignevente.article.item.designation}" />
				</p:column>

				<p:column headerText="prix" width="60">
					<h:outputText value="#{lignevente.prix_ttc}" />
				</p:column>

				<p:column headerText="Qte" width="60">
					<h:outputText value="#{lignevente.qte}" />
				</p:column>
				<p:column headerText="total" width="60">
					<h:outputText value="#{lignevente.totalPrixTTC}" />
				</p:column>

			</p:dataTable>


		</h:form>


	</p:dialog>

</h:body>
</html>